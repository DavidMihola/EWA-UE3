<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.1//EN" "http://www.w3.org/TR/xhtml11/DTD/xhtml11.dtd">
<html xmlns="http://www.w3.org/1999/xhtml"
      xmlns:h="http://java.sun.com/jsf/html"
      xml:lang="de"
      lang="de"
      xmlns:ui="http://java.sun.com/jsf/facelets"
      xmlns:f="http://java.sun.com/jsf/core">

    <head>
        <meta http-equiv="Content-Type" content="application/xhtml+xml; charset=utf-8" />
        <meta name="description" content="EWA Memory Spiel" />
        <meta name="author" content="Christian Zwettler, David Mihola, Florian Mihola" />
        <meta name="keywords" content="EWA, Entwicklung von Webanwendungen, Memory, Spiel, Karten, aufdecken" />

        <title><h:outputText value="#{msg.ewa_memory_game}"/></title>
        <link href="styles/reset.css" rel="stylesheet" type="text/css"
              media="screen" />
        <link href="styles/screen.css" rel="stylesheet" type="text/css"
              media="screen" />

        <!--[if lt IE 8]>
        <link href="styles/ie-screen.css" rel="stylesheet" type="text/css"
	media="screen" />
        <![endif]-->

    </head>

    <body>
    <ui:composition template="./template.xhtml">

        <ui:define name="navigation">
            <ul title="Navigation">
                <li><h:link outcome="/register.xhtml" value="#{msg.back_to_lounge}"/></li>
                <li><h:link outcome="/register.xhtml" value="#{msg.back_to_lounge}"/></li>
                <li><h:link outcome="/register.xhtml" value="#{msg.back_to_lounge}"/></li>
            </ul>
        </ui:define>

        <ui:define name="main">
            <h1 class="hidden"><h:outputText value="#{msg.ewa_memory_game}"/></h1>
            <h:form id="dynamic">
                <div id="stats">
                    <h2 class="hidden"><h:outputText value="#{msg.information_about_game}"/></h2>
                    <h3>Spielstand</h3>
                    <table id="current"
                           title="Spielstand im aktuellen Spiel"
                           summary="Spielstand im aktuellen Spiel">
                        <thead>
                            <tr>
                                <th></th>
                                <th><h:outputText value="#{userSessionBean.currentGame.player1.name}"/></th>
                        <th><h:outputText value="#{userSessionBean.currentGame.player2.name}"/></th>
                        </tr>
                        </thead>
                        <tbody>
                            <tr>
                                <th>Paare</th>
                                <td><h:outputText value="#{userSessionBean.currentGame.player1.pairs}"/></td>
                        <td><h:outputText value="#{userSessionBean.currentGame.player2.pairs}"/></td>
                        </tr>
                        <tr>
                            <th>Versuche</th>
                            <td><h:outputText value="#{userSessionBean.currentGame.player1.tries}"/></td>
                        <td><h:outputText value="#{userSessionBean.currentGame.player2.tries}"/></td>
                        </tr>
                        <tr>
                            <th>Zeit</th>
                            <td><h:outputText value="#{userSessionBean.currentGame.player1.time}"/></td>
                        <td><h:outputText value="#{userSessionBean.currentGame.player2.time}"/></td>
                        </tr>
                        </tbody>
                    </table>
                    <h3>Spielinformationen</h3>
                    <table id="remaining"
                           title="Anzahl der restlichen Paare"
                           summary="Anzahl der restlichen Paare">
                        <tbody>
                            <tr>
                                <th>Restliche Paare</th>
                                <td><!--<h:outputText value="#{userSessionBean.currentGame.board.remainingPairs}"/>--></td>
                            </tr>
                        </tbody>
                    </table>

                    <h3>Highscore</h3>
                    <ul>
                        <li><a href="?petra">Petra: 165 Punkte</a></li>
                        <li><a href="?manuel">Manuel: 128 Punkte</a></li>
                        <li><a href="?lena">Lena: 115 Punkte</a></li>
                        <li><a href="?andi">Andi: 99 Punkte</a></li>
                    </ul>
                </div>
                <div id="cards">
                    <h2 class="hidden"><h:outputText value="#{msg.game_board}"/></h2>

                    <!-- das ui:remove wirkt wie ein Kommentar, der auch für EL-Ausdrücke funktioniert -->
                    <!-- mit dem zusätzlichen Vorteil dass der Editor es nicht als Kommentar kennzeichnet -->
                    <ui:remove>
                        <table summary="Diese Tabelle stellt das Memory-Brett mit den Karten dar">
                            <tr class="hidden">
                                <th>Kartenspalte 1</th>
                                <th>Kartenspalte 2</th>
                                <th>Kartenspalte 3</th>
                                <th>Kartenspalte 4</th>
                                <th>Kartenspalte 5</th>

                            </tr>
                                <ui:repeat value="#{userSessionBean.currentGame.board.cards}" var="row" >
                                    <tr>
                                        <th class="hidden">Kartenzeile #{userSessionBean.currentGame.board.cards.indexOf(row)+1}</th>
                                    <ui:repeat value="#{userSessionBean.currentGame.board.cards}" var="card" >
                                        <td class="#{card.isRevealed?'visible_card':'invisible_card'}">
                                            <h:graphicImage value="#{card.visibleSide}" >

                                                <f:ajax action="#{}userSessionBean.currentgame.boary.tryCard}">
                                        <f:param name="index" value="#{card.index}"/>
                                    </f:ajax>


                                            </h:graphicImage>
                                        </td>
                                    </ui:repeat>
                                    </tr>
                                </ui:repeat>
                        </table>
                    </ui:remove>

                    <!-- ich denke die Aufteilung in Zeilen und Spalten bekommen wir am einfachsten
                    dadurch, dass wir hier statt dem 2er einfach den gewünschten Wert per EL aus irgendeiner
                    Bean auslesen; dann können wir die Verwaltung der Karten als Liste beibehalten und
                    brauchen uns sonst nirgends um Zeilen und Spalten kümmern. D. h. wir haben dann
                    zwar eine Tabelle, die Karten wären aber einfach von 1 bis n² durchnummeriert -->
                    
                    <h:panelGrid columns="2" styleClass="table">
                        <ui:repeat value="#{userSessionBean.currentGame.board.cards}" var="card">
                            <ui:remove>
                            <h:commandLink id="visible_card"
                                           action="#{userSessionBean.tryCard}">
                                <h:graphicImage value="#{card.visibleSide}"
                                                alt="Karte Nummer #{card.index} aufdecken"/>
                                    <!-- TODO: msg.card_alt_{head,tail}-->

                                <f:param name="index" value="#{card.index}"/>
                            </h:commandLink>
                            </ui:remove>
                            <f:ajax>
                            <h:commandLink value="#{card.index}" actionListener="#{userSessionBean.setIndexString}" action="${userSessionBean.tryCard}">
                                <f:attribute name="index" value="#{card.index}"/>
                                <h:graphicImage value="#{card.visibleSide}"
                                                alt="Karte Nummer #{card.index} aufdecken"/>
                                    <!-- TODO: msg.card_alt_{head,tail}-->
                            </h:commandLink>
                            </f:ajax>
                        </ui:repeat>
                    </h:panelGrid>

                </div>
            </h:form>
            <hr class="solid_clear" />
        </ui:define>

    </ui:composition>

</body>
</html>
